- name: Home server | Pre tasks
  hosts: homeserver
  gather_facts: no
  pre_tasks:
    - include_tasks: tasks/change_ssh_port.yml
      tags: port

- name: Home server | Tasks
  hosts: homeserver
  roles:
    #
    # Dependencies
    - role: dependencies/docker
      tags:
        - dependencies
        - docker

    #
    # Security
    - role: security/ssh
      tags:
        - security
        - ssh

    #
    # System
    - role: system/reboot
      tags:
        - system
        - reboot

    - role: system/argoncase
      tags:
        - system
        - argoncase

    - role: system/duckdns
      tags:
        - system
        - duckdns

    #    - role: system/nginx
    #      tags:
    #        - system
    #        - containers
    #        - nginx

    - role: system/swag
      tags:
        - system
        - containers
        - swag

    #- role: system/traefik
    #  tags:
    #    - system
    #    - containers
    #    - traefik

    - role: system/zsh
      tags:
        - system
        - zsh

    #
    # Services - Home automation
    - role: containers/homeautomation/homeassistant
      tags:
        - containers
        - homeautomation
        - homeassistant

    - role: containers/homeautomation/mosquitto
      tags:
        - containers
        - homeautomation
        - mosquitto

    # TODO potentially broken
    #    - role: containers/homeautomation/zigbee2mqtt
    #      tags:
    #        - containers
    #        - homeautomation
    #        - zigbee2mqtt

    #
    # Services - Management
    #- role: containers/management/homer
    #  tags:
    #    - containers
    #    - management
    #    - homer

    #
    # Services - Network
    #- role: containers/network/pihole
    #  tags:
    #    - containers
    #    - network
    #    - pihole